<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>313 — My AI Assistant</title>
    <style>
      :root { --bg:#0b0f14; --panel:#10161b; --text:#e6edf3; --muted:#9aa7b2; --accent:#36c; }
      * { box-sizing: border-box }
      body { margin:0; background:var(--bg); color:var(--text);
             font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif }
      .wrap { max-width:880px; margin:0 auto; padding:24px }
      header { display:flex; align-items:center; gap:12px; margin-bottom:16px }
      .badge { background:linear-gradient(135deg,#2e5cff,#6bc1ff); color:#fff; padding:6px 10px;
               border-radius:999px; font-weight:700 }
      .card { background:var(--panel); border:1px solid #202b33; border-radius:16px;
              box-shadow:0 6px 24px rgba(0,0,0,.3) }
      #chat { height:60vh; overflow:auto; padding:16px; scroll-behavior:smooth }
      .row { display:flex; gap:10px; margin:10px 0 }
      .role { flex:0 0 auto; font-weight:700; color:#7aa2ff }
      .bubble { background:#0d1117; border:1px solid #1f2937; border-radius:14px; padding:12px 14px; white-space:pre-wrap }
      .me .role { color:#ffb159 }
      .me .bubble { background:#111826 }
      .inputbar { display:flex; gap:10px; padding:10px; border-top:1px solid #1e293b }
      input { width:100%; background:#0d1117; color:var(--text); border:1px solid #263244; border-radius:12px; padding:12px }
      button { background:var(--accent); color:white; border:0; border-radius:12px; padding:12px 16px; font-weight:700; cursor:pointer }
      button[disabled] { opacity:.6; cursor:not-allowed }
      .hint { color:var(--muted); font-size:12px; margin-top:6px }
    </style>
  </head>
  <body>
    <div class="wrap">
      <header>
        <span class="badge">313</span>
        <h1 style="margin:0;font-size:20px">Your AI Assistant</h1>
      </header>

      <div class="card" style="display:flex;flex-direction:column;min-height:70vh">
        <div id="chat"></div>
        <form id="form" class="inputbar">
          <input id="msg" placeholder="Ask 313 anything…" autocomplete="off" />
          <button id="send" type="submit">Send</button>
        </form>
        <div class="hint" style="padding:0 12px 12px">313 may make mistakes. Verify important info.</div>
      </div>
    </div>

    <script>
      const chat = document.getElementById('chat');
      const form = document.getElementById('form');
      const msg = document.getElementById('msg');
      const sendBtn = document.getElementById('send');

      const messages = [];

      function addMessage(role, content){
        const row = document.createElement('div');
        row.className = 'row ' + (role === 'user' ? 'me' : '');
        const r = document.createElement('div'); r.className='role'; r.textContent = role === 'user' ? 'You' : '313';
        const b = document.createElement('div'); b.className='bubble'; b.textContent = content;
        row.appendChild(r); row.appendChild(b); chat.appendChild(row);
        chat.scrollTop = chat.scrollHeight;
      }

      addMessage('assistant', "Hi, I'm 313. How can I help today?");

      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const content = msg.value.trim();
        if(!content) return;
        msg.value = '';
        addMessage('user', content);
        sendBtn.disabled = true;

        try{
          messages.push({ role: 'user', content });
          const res = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ messages })
          });
          const data = await res.json();
          if (data?.reply) {
            messages.push({ role: 'assistant', content: data.reply });
            addMessage('assistant', data.reply);
          } else {
            addMessage('assistant', 'Sorry, I could not get a response.');
          }
        } catch(err){
          addMessage('assistant', 'Error: ' + (err?.message || err));
        } finally {
          sendBtn.disabled = false;
        }
      });
    </script>
  </body>
</html>
